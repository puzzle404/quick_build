<div class="rounded-3xl border border-slate-200 bg-white p-6 shadow-sm">
  <div class="flex items-center justify-between gap-4">
    <h2 class="text-lg font-semibold text-slate-900">Planificación y alcance</h2>
    <span class="text-xs font-medium uppercase tracking-wide text-slate-400">Seguimiento</span>
  </div>

  <dl class="mt-6 grid gap-6 sm:grid-cols-2">
    <div class="rounded-2xl bg-slate-50 p-4">
      <dt class="text-xs font-semibold uppercase tracking-wide text-slate-500">Fechas clave</dt>
      <dd class="mt-3 space-y-1 text-sm text-slate-700">
        <p><span class="font-medium text-slate-900">Inicio:</span> <%= formatted_project_date(project.start_date) %></p>
        <p><span class="font-medium text-slate-900">Fin:</span> <%= formatted_project_date(project.end_date) %></p>
        <p><span class="font-medium text-slate-900">Duración:</span> <%= project.duration_text || "Sin definir" %></p>
      </dd>
    </div>
    <div class="rounded-2xl bg-slate-50 p-4">
      <dt class="text-xs font-semibold uppercase tracking-wide text-slate-500">Ubicación</dt>
      <dd class="mt-3 space-y-2 text-sm text-slate-700">
        <p><%= project.location_label %></p>
        <div class="flex flex-wrap items-center gap-2 text-xs">
          <span class="inline-flex h-2 w-2 rounded-full <%= project.coordinates_badge_color %>"></span>
          <span class="text-slate-500"><%= project.coordinates_status %></span>
        </div>
        <% if project.coordinates_label.present? %>
          <p class="text-xs text-slate-500"><%= project.coordinates_label %></p>
        <% end %>
      </dd>
    </div>
  </dl>

  <div class="mt-8 space-y-6">
    <div class="flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between">
      <div>
        <h3 class="text-base font-semibold text-slate-900">Etapas de la obra</h3>
        <p class="text-sm text-slate-500">Organizá los hitos principales y conectalos con sus listas de materiales.</p>
      </div>
      <span class="inline-flex items-center rounded-full bg-slate-100 px-3 py-1 text-xs font-semibold text-slate-600">
        <%= pluralize(project_stages.size, "etapa") %>
      </span>
    </div>

    <div class="space-y-4" id="project_stages">
      <% if project_stages.any? %>
        <% project_stages.each do |stage| %>
          <%= render Constructors::Projects::Stages::StageCardComponent.new(project: project_record, stage: stage) %>
        <% end %>
      <% else %>
        <div class="rounded-2xl border border-dashed border-slate-200 bg-slate-50 p-6 text-sm text-slate-500">
          Todavía no cargaste etapas para esta obra. Empezá definiendo el nombre y el rango de fechas para organizar la planificación.
        </div>
      <% end %>
    </div>
  </div>

  <% if helpers.policy(ProjectStage.new(project: project_record)).create? %>
    <div class="mt-8 rounded-2xl border border-slate-200 bg-slate-50 p-6">
      <h3 class="text-base font-semibold text-slate-900">Agregar nueva etapa</h3>
      <p class="mt-1 text-sm text-slate-500">Define un bloque de trabajo con fechas para coordinar materiales y tareas.</p>

      <% if new_stage.errors.any? %>
        <div class="mt-4 rounded-lg border border-red-200 bg-red-50 p-3 text-sm text-red-700">
          <p class="font-semibold">No pudimos guardar la etapa:</p>
          <ul class="mt-2 list-disc space-y-1 pl-5">
            <% new_stage.errors.full_messages.each do |message| %>
              <li><%= message %></li>
            <% end %>
          </ul>
        </div>
      <% end %>

      <%= helpers.turbo_frame_tag "new_project_stage" do %>
        <%= render Constructors::Projects::Stages::StageFormComponent.new(project: project_record, stage: new_stage) %>
      <% end %>
    </div>
  <% end %>
</div>
