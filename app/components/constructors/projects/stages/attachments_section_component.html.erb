<section class="rounded-2xl border border-slate-200 bg-white p-6 shadow-sm">
  <div class="flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between">
    <div>
      <h2 class="text-lg font-semibold text-slate-900"><%= title %></h2>
      <p class="text-sm text-slate-500"><%= description %></p>
    </div>
    <% if can_manage? %>
      <%= render Ui::ButtonComponent.new(label: "Agregar #{title.downcase}", path: upload_path, size: :sm) %>
    <% end %>
  </div>

  <% if attachments.any? %>
    <% if kind == :documents %>
      <ul class="mt-5 space-y-3 text-sm text-slate-600">
        <% attachments.each do |document| %>
          <li class="rounded-xl border border-slate-200 bg-slate-50 p-4">
            <div class="flex flex-wrap items-start justify-between gap-3">
              <div>
                <p class="font-semibold text-slate-900"><%= document.file_name %></p>
                <p class="text-xs text-slate-500">
                  <%= helpers.number_to_human_size(document.file_byte_size) if document.file_byte_size %>
                  · Hace <%= helpers.time_ago_in_words(document.uploaded_at) %>
                </p>
              </div>
              <div class="flex flex-wrap items-center gap-2 text-xs">
                <%= helpers.link_to 'Ver', helpers.rails_blob_url(document.file, disposition: 'inline'), target: '_blank', class: 'font-medium text-slate-600 hover:text-slate-800' %>
                <%= helpers.link_to 'Descargar', helpers.url_for(document.file), class: 'font-medium text-indigo-600 hover:text-indigo-700' %>
                <% if can_manage? %>
                  <%= helpers.button_to 'Eliminar',
                                        helpers.constructors_project_stage_document_path(project, stage, document),
                                        method: :delete,
                                        class: 'font-medium text-red-600 hover:text-red-700',
                                        data: { turbo_confirm: '¿Seguro que querés eliminar este documento?' } %>
                <% end %>
              </div>
            </div>
            <details class="mt-3">
              <summary class="cursor-pointer select-none text-xs font-medium text-slate-500 hover:text-slate-700">Ver previsualización</summary>
              <div class="mt-3 overflow-hidden rounded-lg border border-slate-200">
                <iframe src="<%= helpers.rails_storage_proxy_path(document.file, disposition: 'inline') %>#view=FitH" class="h-72 w-full" title="Previsualización documento"></iframe>
              </div>
            </details>
          </li>
        <% end %>
      </ul>
    <% else %>
      <div class="mt-5 grid grid-cols-2 gap-4 sm:grid-cols-3 lg:grid-cols-4">
        <% attachments.each do |image| %>
          <div class="overflow-hidden rounded-xl border border-slate-200 bg-slate-50">
            <% if image.file.variable? %>
              <%= helpers.image_tag image.file.variant(resize_to_fill: [480, 320]), class: 'h-40 w-full object-cover' %>
            <% else %>
              <div class="flex h-40 w-full items-center justify-center text-xs text-slate-500">Imagen adjunta</div>
            <% end %>
            <div class="flex items-center justify-between border-t border-slate-100 px-3 py-2 text-xs text-slate-600">
              <span class="truncate" title="<%= image.title.presence || image.file_filename.to_s %>"><%= image.title.presence || image.file_filename.to_s %></span>
              <div class="flex items-center gap-2">
                <%= helpers.link_to 'Abrir', helpers.url_for(image.file), target: '_blank', class: 'font-medium text-indigo-600 hover:text-indigo-700' %>
                <% if can_manage? %>
                  <%= helpers.button_to 'Eliminar',
                                        helpers.constructors_project_stage_image_path(project, stage, image),
                                        method: :delete,
                                        class: 'font-medium text-red-600 hover:text-red-700',
                                        data: { turbo_confirm: '¿Seguro que querés eliminar esta imagen?' } %>
                <% end %>
              </div>
            </div>
          </div>
        <% end %>
      </div>
    <% end %>
  <% else %>
    <p class="mt-5 text-sm text-slate-500"><%= empty_text %></p>
  <% end %>
</section>
