<div class="w-full space-y-8 pb-14">
  <section class="rounded-3xl border border-slate-200 bg-white px-4 py-6 shadow-sm sm:p-8">
    <div class="flex flex-col gap-6 lg:flex-row lg:items-start lg:justify-between">
      <div class="space-y-4">
        <p class="inline-flex items-center gap-2 text-xs font-medium uppercase tracking-wide text-indigo-500">
          <span class="inline-flex h-2 w-2 rounded-full bg-indigo-500"></span>
          Edición de obra
        </p>
        <div class="space-y-2">
          <h1 class="text-3xl font-semibold text-slate-900">Actualizar información del proyecto</h1>
          <p class="text-sm text-slate-600">
            Ajusta los datos clave de la obra para mantener al equipo sincronizado. Los cambios se reflejan en los tableros y reportes en tiempo real.
          </p>
        </div>
      </div>
      <div class="flex flex-col gap-3 sm:flex-row sm:items-center">
        <%= render Ui::ButtonComponent.new(
              label: "Ver resumen",
              path: constructors_project_path(@project),
              variant: :secondary,
              size: :sm
            ) %>
        <%= render Ui::ButtonComponent.new(
              label: "Volver al listado",
              path: constructors_projects_path,
              variant: :link,
              size: :sm,
              class_name: "rounded-none border-none px-0 py-0 text-sm"
            ) %>
      </div>
    </div>
  </section>

  <div class="grid gap-6 lg:grid-cols-[minmax(0,2fr)_minmax(0,1fr)]">
    <section class="rounded-3xl border border-slate-200 bg-white px-4 py-6 shadow-sm sm:p-8">
      <div class="flex flex-col gap-2 border-b border-slate-100 pb-5 sm:flex-row sm:items-center sm:justify-between">
        <div>
          <h2 class="text-lg font-semibold text-slate-900">Datos del proyecto</h2>
          <p class="text-sm text-slate-500">Completa la información operativa para planificar y coordinar actividades.</p>
        </div>
        <span class="inline-flex items-center gap-2 rounded-full bg-slate-100 px-3 py-1 text-xs font-semibold text-slate-600">
          Última edición <%= time_ago_in_words(@project.updated_at || @project.created_at) %>
        </span>
      </div>

      <div class="mt-6 space-y-8">
        <%= render "form", project: @project %>

        <div class="rounded-2xl border border-dashed border-slate-200 bg-slate-50 p-4 text-sm text-slate-600">
          <p class="font-semibold text-slate-800">Consejo:</p>
          <p class="mt-1 leading-relaxed">
            Mantén las fechas actualizadas para desbloquear los tableros de Gantt y la curva S. Si aún no conoces el fin estimado, déjalo en blanco y podrás completarlo más adelante.
          </p>
        </div>
      </div>
    </section>

    <aside class="space-y-6">
      <div class="rounded-3xl border border-slate-200 bg-white px-4 py-5 shadow-sm sm:p-6">
        <h2 class="text-sm font-semibold text-slate-900">Resumen operativo</h2>
        <div class="mt-4 grid gap-4 sm:grid-cols-2">
          <%= render Ui::MetricCardComponent.new(
                title: "Estado",
                value: @project_summary.status.humanize,
                description: "Define cómo se mostrará en tableros y reportes."
              ) %>
          <%= render Ui::MetricCardComponent.new(
                title: "Duración estimada",
                value: @project_summary.duration_text || "—",
                description: @project_summary.duration_hint
              ) %>
          <%= render Ui::MetricCardComponent.new(
                title: "Inicio programado",
                value: formatted_project_date(@project_summary.start_date)
              ) %>
          <%= render Ui::MetricCardComponent.new(
                title: "Fin estimado",
                value: formatted_project_date(@project_summary.end_date)
              ) %>
        </div>
      </div>

      <div class="rounded-3xl border border-slate-200 bg-white px-4 py-5 shadow-sm sm:p-6">
        <h2 class="text-sm font-semibold text-slate-900">Accesos rápidos</h2>
        <ul class="mt-4 space-y-3 text-sm text-slate-600">
          <li class="flex items-center justify-between rounded-2xl bg-slate-50 px-4 py-3">
            <div>
              <p class="font-semibold text-slate-900">Equipo y permisos</p>
              <p class="text-xs text-slate-500">Gestiona administradores, responsables y observadores.</p>
            </div>
            <%= link_to constructors_project_path(@project, anchor: "project-team-members"), class: "text-indigo-600 hover:text-indigo-700" do %>
              <span class="sr-only">Ir al equipo</span>
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="m9 5 7 7-7 7" />
              </svg>
            <% end %>
          </li>
          <li class="flex items-center justify-between rounded-2xl border border-slate-200 px-4 py-3">
            <div>
              <p class="font-semibold text-slate-900">Documentos y evidencia</p>
              <p class="text-xs text-slate-500">Agrega planos, fotos y respaldos clave del proyecto.</p>
            </div>
            <span class="text-xs font-semibold text-slate-500"><%= @project_summary.attachments_count %> archivos</span>
          </li>
          <li class="flex items-center justify-between rounded-2xl border border-slate-200 px-4 py-3">
            <div>
              <p class="font-semibold text-slate-900">Responsable principal</p>
              <p class="text-xs text-slate-500"><%= @project_summary.owner.email %></p>
            </div>
            <span class="inline-flex h-2 w-2 rounded-full bg-emerald-500"></span>
          </li>
        </ul>
      </div>

      <div class="rounded-3xl border border-slate-200 bg-white px-4 py-5 shadow-sm sm:p-6">
        <h2 class="text-sm font-semibold text-slate-900">Vista previa de documentos</h2>
        <% if @project_summary.images.attached? %>
          <div class="mt-3 flex gap-3 overflow-x-auto pb-1">
            <% @project_summary.images.each do |image| %>
              <% preview = image.variable? ? image.variant(resize_to_fill: [180, 120]) : image %>
              <div class="h-24 w-36 flex-shrink-0 overflow-hidden rounded-xl border border-slate-200 bg-slate-100">
                <%= image_tag preview, class: "h-full w-full object-cover", alt: image.filename.to_s %>
              </div>
            <% end %>
          </div>
        <% else %>
          <p class="mt-3 text-sm text-slate-500">Aún no se subieron archivos. Puedes agregarlos con el campo superior “Imágenes del proyecto”.</p>
        <% end %>
      </div>
    </aside>
  </div>
</div>
