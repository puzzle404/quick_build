<%= render Constructors::Projects::SectionsNavComponent.new(project: @project, current_section: :materials) %>

<div class="space-y-6 lg:flex lg:items-start lg:justify-between lg:space-y-0">
  <div>
    <h1 class="text-2xl font-semibold text-slate-900">Listas de materiales</h1>
    <p class="mt-1 text-sm text-slate-500">
      Organizá los insumos de la obra, cargalos manualmente o subí archivos para procesarlos más adelante.
    </p>
  </div>

  <% if policy(@project).manage_materials? %>
    <%= link_to "Nueva lista", new_constructors_project_material_list_path(@project),
                class: "inline-flex items-center rounded-lg bg-emerald-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-emerald-500 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-2" %>
  <% end %>
</div>

<div class="mt-6 grid gap-4 sm:grid-cols-2">
  <% @material_lists.each do |list| %>
    <%= link_to constructors_project_material_list_path(@project, list),
                class: "flex flex-col rounded-2xl border border-slate-200 bg-white p-4 text-left shadow-sm transition hover:-translate-y-0.5 hover:border-emerald-200 hover:shadow-lg" do %>
      <div class="flex items-center justify-between">
        <p class="text-base font-semibold text-slate-900"><%= list.name %></p>
        <% if (publication = list.material_list_publication) %>
          <span class="rounded-full bg-emerald-100 px-2.5 py-0.5 text-xs font-medium text-emerald-700">
            <%= publication.visibility_public? ? "Permitido presupuestar" : "Uso interno" %>
          </span>
        <% else %>
          <span class="rounded-full bg-slate-100 px-2.5 py-0.5 text-xs font-medium text-slate-600">
            Uso interno
          </span>
        <% end %>
      </div>
      <p class="mt-2 text-sm text-slate-500">
        <%= pluralize(list.material_items.size, "ítem") %> · Actualizado <%= time_ago_in_words(list.updated_at) %> atrás
      </p>
      <p class="mt-4 line-clamp-3 text-sm text-slate-600">
        <%= list.notes.presence || "Sin notas todavía." %>
      </p>
    <% end %>
  <% end %>

  <% if @material_lists.empty? %>
    <div class="rounded-2xl border border-dashed border-slate-200 bg-white p-8 text-center text-sm text-slate-500">
      Todavía no generaste listas de materiales para esta obra. Arrancá creando una, o subí un archivo para procesarlo.
    </div>
  <% end %>
</div>
