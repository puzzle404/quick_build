<%= render Constructors::Projects::SectionsNavComponent.new(project: @project, current_section: :people) %>

<div class="space-y-6">
  <div class="flex flex-col justify-between gap-4 sm:flex-row sm:items-center">
    <div>
      <%= link_to "← Volver", constructors_project_people_path(@project), class: "text-sm font-medium text-emerald-700 hover:text-emerald-600" %>
      <h1 class="mt-2 text-2xl font-semibold text-slate-900"><%= @person.full_name %></h1>
      <p class="mt-1 text-sm text-slate-500">
        <%= @person.role_title.presence || "Sin rol especificado" %>
      </p>
    </div>
    <div class="flex flex-wrap gap-3">
      <% if policy(@person).update? %>
        <%= render Ui::ButtonComponent.new(label: "Editar", path: edit_constructors_project_person_path(@project, @person), variant: :secondary) %>
      <% end %>
      <% if policy(@person).destroy? %>
        <%= render Ui::ButtonComponent.new(label: "Eliminar", path: constructors_project_person_path(@project, @person), turbo_method: :delete, variant: :danger, turbo_confirm: "¿Seguro que querés eliminar esta persona?") %>
      <% end %>
    </div>
  </div>

  <div class="grid gap-6 lg:grid-cols-3">
    <div class="lg:col-span-2 space-y-6">
      <div class="rounded-2xl border border-slate-200 bg-white p-4 shadow-sm">
        <p class="text-sm font-medium text-slate-600 uppercase tracking-wide">Datos</p>
        <dl class="mt-3 grid gap-4 sm:grid-cols-2 text-sm text-slate-700">
          <div>
            <dt class="text-slate-500">Documento</dt>
            <dd class="mt-1"><%= @person.document_id.presence || "—" %></dd>
          </div>
          <div>
            <dt class="text-slate-500">Teléfono</dt>
            <dd class="mt-1"><%= @person.phone.presence || "—" %></dd>
          </div>
          <div>
            <dt class="text-slate-500">Estado</dt>
            <dd class="mt-1"><%= @person.status.humanize %></dd>
          </div>
          <div>
            <dt class="text-slate-500">Vigencia</dt>
            <dd class="mt-1">
              <%= @person.start_date ? l(@person.start_date, format: :short) : "—" %>
              <% if @person.end_date.present? %>
                · <%= l(@person.end_date, format: :short) %>
              <% end %>
            </dd>
          </div>
        </dl>
        <% if @person.notes.present? %>
          <p class="mt-3 text-sm text-slate-700 whitespace-pre-line"><%= @person.notes %></p>
        <% end %>
      </div>

      <div class="rounded-2xl border border-slate-200 bg-white p-4 shadow-sm">
        <div class="flex items-center justify-between">
          <p class="text-sm font-medium text-slate-600 uppercase tracking-wide">Asistencias</p>
          <%= render Ui::ButtonComponent.new(label: "Dar presente", path: constructors_project_person_attendances_path(@project, @person), turbo_method: :post, variant: :primary) %>
        </div>
        <ul class="mt-4 divide-y divide-slate-100 text-sm text-slate-700">
          <% @recent_attendances.each do |att| %>
            <li class="py-2 flex items-center justify-between">
              <span>
                <%= l(att.occurred_at, format: :long) %>
                <% if att.coordinates? %>
                  · <span class="text-xs text-slate-500">(<%= att.latitude %>, <%= att.longitude %>)</span>
                <% end %>
              </span>
              <span class="text-xs text-slate-500"><%= att.source.humanize %></span>
            </li>
          <% end %>
          <% if @recent_attendances.empty? %>
            <li class="py-4 text-slate-500">Sin asistencias registradas.</li>
          <% end %>
        </ul>
      </div>
    </div>

    <div class="space-y-4">
      <div class="rounded-2xl border border-slate-200 bg-white p-4 shadow-sm">
        <p class="text-sm font-medium text-slate-600 uppercase tracking-wide">Próximos pasos</p>
        <p class="mt-2 text-sm text-slate-500">En futuras iteraciones, el trabajador podrá registrarse desde su móvil, enviar ubicación y recibir notas.</p>
      </div>
    </div>
  </div>
</div>

