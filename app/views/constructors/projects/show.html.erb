<div class="space-y-8 pb-12">
  <section class="rounded-3xl border border-slate-200 bg-white p-6 shadow-sm sm:p-8">
    <div class="flex flex-col gap-6 md:flex-row md:items-center md:justify-between">
      <div class="space-y-4">
        <div class="flex flex-wrap items-center gap-3 text-sm text-slate-600">
          <%= project_status_badge(@project) %>
          <% if @project.updated_at %>
            <span class="inline-flex items-center gap-2 text-xs text-slate-500">
              <span class="h-2 w-2 rounded-full bg-emerald-500"></span>
              Actualizado hace <%= time_ago_in_words(@project.updated_at) %>
            </span>
          <% end %>
        </div>
        <div>
          <h1 class="text-3xl font-semibold leading-tight text-slate-900"><%= @project.name %></h1>
          <p class="mt-2 flex flex-wrap items-center gap-2 text-sm text-slate-600">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="h-4 w-4 text-indigo-500">
              <path fill="currentColor" d="M12 2a7 7 0 0 0-7 7c0 4.63 5.55 11.2 6.21 11.96a1 1 0 0 0 1.58 0C13.45 20.2 19 13.63 19 9a7 7 0 0 0-7-7m0 16.35C10.12 16 7 11.73 7 9a5 5 0 1 1 10 0c0 2.73-3.12 7-5 9.35M12 7a2 2 0 1 0 2 2a2 2 0 0 0-2-2" />
            </svg>
            <span><%= @project.location_label %></span>
          </p>
          <div class="mt-4 grid gap-4 text-sm text-slate-600 sm:grid-cols-3">
            <div>
              <dt class="text-xs uppercase tracking-wide text-slate-500">Inicio programado</dt>
              <dd class="mt-1 text-base font-medium text-slate-900"><%= formatted_project_date(@project.start_date) %></dd>
            </div>
            <div>
              <dt class="text-xs uppercase tracking-wide text-slate-500">Fin estimado</dt>
              <dd class="mt-1 text-base font-medium text-slate-900"><%= formatted_project_date(@project.end_date) %></dd>
            </div>
            <div>
              <dt class="text-xs uppercase tracking-wide text-slate-500">Responsable</dt>
              <dd class="mt-1 text-base font-medium text-slate-900"><%= @project.owner.email %></dd>
            </div>
          </div>
        </div>
      </div>
      <div class="flex flex-col gap-3 sm:flex-row sm:items-center">
        <%= link_to 'Editar obra', edit_constructors_project_path(@project), class: 'inline-flex items-center justify-center gap-2 rounded-full bg-indigo-600 px-5 py-2 text-sm font-semibold text-white shadow-sm transition hover:bg-indigo-700 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-500' %>
        <%= link_to 'Volver a mis obras', constructors_projects_path, class: 'inline-flex items-center justify-center gap-2 rounded-full border border-slate-200 px-5 py-2 text-sm font-semibold text-slate-700 transition hover:border-slate-300 hover:text-slate-900 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-500' %>
      </div>
    </div>
  </section>

  <section class="grid gap-4 md:grid-cols-2 xl:grid-cols-4">
    <div class="rounded-2xl border border-slate-200 bg-white p-5 shadow-sm">
      <p class="text-sm font-medium text-slate-500">Duración estimada</p>
      <div class="mt-3 flex items-baseline gap-2">
        <span class="text-3xl font-semibold text-slate-900"><%= @project.duration_text || '—' %></span>
      </div>
      <p class="mt-2 text-xs text-slate-500"><%= @project.duration_hint %></p>
    </div>
    <div class="rounded-2xl border border-slate-200 bg-white p-5 shadow-sm">
      <p class="text-sm font-medium text-slate-500">Miembros activos</p>
      <div class="mt-3 flex items-baseline gap-2">
        <span class="text-3xl font-semibold text-slate-900"><%= @project.total_members %></span>
        <span class="text-sm text-slate-500">colaboradores</span>
      </div>
      <p class="mt-2 text-xs text-slate-500">Incluye administradores, editores y observadores.</p>
    </div>
    <div class="rounded-2xl border border-slate-200 bg-white p-5 shadow-sm">
      <p class="text-sm font-medium text-slate-500">Tiempo transcurrido</p>
      <div class="mt-3 flex items-baseline gap-2">
        <span class="text-3xl font-semibold text-slate-900"><%= @project.elapsed_days || '—' %></span>
        <span class="text-sm text-slate-500"><%= @project.time_elapsed_hint %></span>
      </div>
      <p class="mt-2 text-xs text-slate-500">Se calcula al registrar la fecha de inicio.</p>
    </div>
    <div class="rounded-2xl border border-slate-200 bg-white p-5 shadow-sm">
      <p class="text-sm font-medium text-slate-500">Documentos adjuntos</p>
      <div class="mt-3 flex items-baseline gap-2">
        <span class="text-3xl font-semibold text-slate-900"><%= @project.attachments_count %></span>
        <span class="text-sm text-slate-500">archivos</span>
      </div>
      <p class="mt-2 text-xs text-slate-500">Planos, fotos e información respaldatoria de la obra.</p>
    </div>
  </section>

  <section class="grid gap-6 lg:grid-cols-3">
    <div class="space-y-6 lg:col-span-2">
      <div class="rounded-3xl border border-slate-200 bg-white p-6 shadow-sm">
        <div class="flex items-center justify-between gap-4">
          <h2 class="text-lg font-semibold text-slate-900">Planificación y alcance</h2>
          <span class="text-xs font-medium uppercase tracking-wide text-slate-400">Seguimiento</span>
        </div>
        <dl class="mt-6 grid gap-6 sm:grid-cols-2">
          <div class="rounded-2xl bg-slate-50 p-4">
            <dt class="text-xs font-semibold uppercase tracking-wide text-slate-500">Fechas clave</dt>
            <dd class="mt-3 space-y-1 text-sm text-slate-700">
              <p><span class="font-medium text-slate-900">Inicio:</span> <%= formatted_project_date(@project.start_date) %></p>
              <p><span class="font-medium text-slate-900">Fin:</span> <%= formatted_project_date(@project.end_date) %></p>
              <p><span class="font-medium text-slate-900">Duración:</span> <%= @project.duration_text || 'Sin definir' %></p>
            </dd>
          </div>
          <div class="rounded-2xl bg-slate-50 p-4">
            <dt class="text-xs font-semibold uppercase tracking-wide text-slate-500">Ubicación</dt>
            <dd class="mt-3 space-y-2 text-sm text-slate-700">
              <p><%= @project.location_label %></p>
              <div class="flex flex-wrap items-center gap-2 text-xs">
                <span class="inline-flex h-2 w-2 rounded-full <%= @project.coordinates_badge_color %>"></span>
                <span class="text-slate-500"><%= @project.coordinates_status %></span>
              </div>
              <% if @project.coordinates_label %>
                <p class="text-xs text-slate-500"><%= @project.coordinates_label %></p>
              <% end %>
            </dd>
          </div>
        </dl>
        <div class="mt-6 rounded-2xl border border-dashed border-slate-200 p-4 text-sm text-slate-500">
          Define hitos, tareas WBS y responsables desde la sección de planificación cuando esté disponible. Mientras tanto, utiliza este panel para centralizar toda la información clave de la obra.
        </div>
      </div>

      <div class="rounded-3xl border border-slate-200 bg-white p-6 shadow-sm">
        <div class="flex items-center justify-between gap-4">
          <h2 class="text-lg font-semibold text-slate-900">Documentos y evidencias</h2>
          <%= link_to 'Gestionar archivos', edit_constructors_project_path(@project), class: 'text-sm font-semibold text-indigo-600 hover:text-indigo-700' %>
        </div>
        <% if @project.images.attached? %>
          <div class="mt-5 flex gap-4 overflow-x-auto pb-2">
            <% @project.images.each do |image| %>
              <% preview = image.variable? ? image.variant(resize_to_fill: [320, 200]) : image %>
              <div class="relative h-32 w-48 flex-shrink-0 overflow-hidden rounded-2xl border border-slate-200 bg-slate-100">
                <%= image_tag(preview, class: 'h-full w-full object-cover', alt: image.filename.to_s) %>
              </div>
            <% end %>
          </div>
        <% else %>
          <p class="mt-5 text-sm text-slate-500">Todavía no se cargaron planos, fotos ni documentos para esta obra. Puedes hacerlo desde la edición del proyecto.</p>
        <% end %>
      </div>
    </div>

    <div class="space-y-6">
      <div class="rounded-3xl border border-slate-200 bg-white p-6 shadow-sm">
        <h2 class="text-lg font-semibold text-slate-900">Equipo de la obra</h2>
        <p class="mt-1 text-sm text-slate-500">Administra quién puede colaborar, revisar y ejecutar tareas dentro del proyecto.</p>
        <ul class="mt-6 space-y-3">
          <% if @project.members.any? %>
            <% @project.members.each do |member| %>
              <li class="flex items-start justify-between gap-4 rounded-2xl border border-slate-200 bg-slate-50 p-4">
                <div>
                  <p class="text-sm font-semibold text-slate-900"><%= member.email %></p>
                  <p class="mt-1 text-xs text-slate-500"><%= member.role.humanize %></p>
                </div>
                <%= button_to 'Quitar', constructors_project_project_membership_path(@project, member), method: :delete, data: { turbo_confirm: '¿Eliminar a este miembro del proyecto?' }, class: 'inline-flex items-center rounded-full border border-slate-200 px-3 py-1 text-xs font-medium text-rose-600 transition hover:border-rose-400 hover:text-rose-700' %>
              </li>
            <% end %>
          <% else %>
            <li class="rounded-2xl border border-dashed border-slate-200 p-6 text-sm text-slate-500">Todavía no se agregaron colaboradores a la obra.</li>
          <% end %>
        </ul>

        <div class="mt-6 rounded-2xl border border-slate-200 bg-white p-4">
          <h3 class="text-sm font-semibold text-slate-900">Agregar colaborador</h3>
          <%= form_with model: [:constructors, @project, @membership], local: true, class: 'mt-4 space-y-4' do |form| %>
            <div>
              <%= form.label :user_id, 'Selecciona un usuario', class: 'text-sm font-medium text-slate-700' %>
              <%= form.select :user_id, options_for_select(User.all.pluck(:email, :id)), { prompt: 'Escoge un usuario' }, class: 'mt-1 w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm text-slate-700 focus:border-indigo-500 focus:outline-none focus:ring-2 focus:ring-indigo-200' %>
            </div>
            <div>
              <%= form.label :role, 'Rol en el proyecto', class: 'text-sm font-medium text-slate-700' %>
              <%= form.select :role, ProjectMembership.roles.keys.map { |role| [role.titleize, role] }, { prompt: 'Selecciona un rol' }, class: 'mt-1 w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm text-slate-700 focus:border-indigo-500 focus:outline-none focus:ring-2 focus:ring-indigo-200' %>
            </div>
            <div class="flex justify-end">
              <%= render Ui::FormButtonComponent.new(form: form, label: 'Agregar miembro') %>
            </div>
          <% end %>
        </div>
      </div>

      <div class="rounded-3xl border border-slate-200 bg-white p-6 shadow-sm">
        <div class="flex items-center justify-between gap-4">
          <h2 class="text-lg font-semibold text-slate-900">Actividad reciente</h2>
          <span class="text-xs font-medium uppercase tracking-wide text-slate-400">Timeline</span>
        </div>
        <% if @activity_entries.any? %>
          <ol class="mt-6 space-y-4">
            <% @activity_entries.each do |entry| %>
              <li class="rounded-2xl border border-slate-200 bg-slate-50 p-4">
                <p class="text-sm font-semibold text-slate-900"><%= entry[:title] %></p>
                <% if entry[:timestamp] %>
                  <p class="text-xs text-slate-500">Hace <%= time_ago_in_words(entry[:timestamp]) %> · <%= l(entry[:timestamp], format: :long) %></p>
                <% end %>
                <p class="mt-2 text-sm text-slate-600"><%= entry[:description] %></p>
              </li>
            <% end %>
          </ol>
        <% else %>
          <p class="mt-5 text-sm text-slate-500">Todavía no hay actividad registrada para mostrar. A medida que se sumen miembros y avances, verás un resumen aquí.</p>
        <% end %>
      </div>
    </div>
  </section>
</div>
